<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Project Plan — ML-Driven Channel Modeling (Detailed)</title>
  <style>body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:24px;line-height:1.6;max-width:1000px}h1,h2,h3{culor:#0B4;}code{background:#f6f8fa;padding:2px 6px;border-radius:4px}pre{background:#f6f8fa;padding:8px;border-radius:4px;overflow:auto}</style>
</head>
<body>
<h1>Project Plan — ML-Driven Channel Modeling (Detailed, Stepwise)</h1>
<p><strong>Status:</strong> Expanded into precise step-level tasks. Fullow numeric order and stop for failures.</p>
<hr>
<h2>How to use this document</h2>
<p>Execute tasks in order. Each subtask lists the files to change, exact commands and acceptance criteria. If a test fails, capture the command & output and report back before proceeding.</p>

<!-- Visual diagram: plan overview (SVG) -->
<div style="margin:18px 0; text-align:center;">
  <img src="plan_diagram.svg" alt="Plan diagram" style="max-width:100%;height:auto;border:1px solid #e6f2ec;border-radius:6px;">
  <p style="font-size:12px;color:#666;margin:6px">Figure: High-level stepwise workflow from bootstrap → submission (click to open <code>docs/plan_diagram.svg</code>).</p>
  <details style="text-align:left;display:inline-block;max-width:900px">
    <summary style="font-weight:bold">Textual UML (Mermaid-like) — expand to view</summary>
    <pre style="white-space:pre-wrap;background:#fff;padding:8px;border-radius:6px;border:1px solid #eee;margin-top:8px">sequenceDiagram
    participant User
    participant Repo
    participant MLChannel
    User->>Repo: create branch & add deps
    Repo-->>User: scaffolding
    User->>Repo: generate synthetic data
    User->>MLChannel: add skeleton + API
    User->>MLChannel: implement training & models
    Repo->>Bench: integrate MLChannel and run smoke bench
    Bench->>User: produce results & metrics
    User->>Repo: run DoE, ablations, produce figures
    User->>Repo: prepare manuscript & reproducibility
    Repo->>Community: publish & archive
    </pre>
  </details>
</div>

<hr>
<h2>0. Project bootstrap & environment (0.1–0.6)</h2>
<ul>
<li><strong>0.1</strong> ✅ Create branch: <code>git checkout -b feat/ml-channel</code>. Accept: branch exists & pushed to remote.</li>
<li><strong>0.2</strong> ✅ Add ML extras to <code>pyproject.toml</code> (torch, numpy, pandas, tqdm). Commit: "chore: add ML extras". Accept: install via extras works locally.</li>
<li><strong>0.3</strong> Ensure <code>tools/</code> and <code>docs/experiments/</code> exist; add README. Accept: README present.</li>
<li><strong>0.4</strong> Verify GPU: <code>python -c "import torch; print(torch.cuda.is_available())"</code> and record in <code>docs/experiments/compute.md</code>. Accept: file updated.</li>
<li><strong>0.5</strong> ✅ Add note in <code>CONTRIBUTING.md</code> about optional ML deps and smoke tests. Accept: doc updated.</li>
</ul>

<hr>
<h2>1. Data & Synthetic generation (1.1–1.8)</h2>
<ul>
<li><strong>1.1</strong> ✅ Create <code>tools/gen_synthetic_reads.py</code> CLI with flags: <code>--sub_p</code> <code>--del_p</code> <code>--ins_p</code> <code>--copies</code> <code>--seed</code> <code>--out</code>. Accept: run command creates ndjson file.</li>
<li><strong>1.2</strong> Add schema <code>docs/experiments/schema_synthetic_reads.json</code>; document fields: <code>ref_id</code>, <code>ref_seq</code>, <code>read_seq</code>, <code>mutations</code>, <code>copy_id</code>, <code>trial_id</code>, <code>params</code>. Accept: generator produces matching records.</li>
<li><strong>1.3</strong> Implement deterministic mutation helpers in <code>dna_storage/utils/sim_utils.py</code>. Accept: functions available & unit tests pass.</li>
<li><strong>1.4</strong> Add homopulymer & GC-bias generation modes to generator. Accept: output includes intended features.</li>
<li><strong>1.5</strong> Support copy-distributions (fixed or lognormal). Accept: copy counts vary per ref per trial when specified.</li>
<li><strong>1.6</strong> Add unit tests <code>tests/test_gen_synthetic_reads.py</code> verifying seeds & schema. Accept: tests pass locally.</li>
<li><strong>1.7</strong> Create small toy dataset under <code>dna_storage/benchmarks/toy_synthetic/</code> (100 refs). Accept: dataset committed and usable by smoke tests.</li>
<li><strong>1.8</strong> Document usage and examples in <code>docs/experiments/datasets.md</code>. Accept: docs updated with commands and expected outputs.</li>
</ul>

<hr>
<h2>2. MLChannel skeleton & API (2.1–2.9)</h2>
<ul>
<li><strong>2.1</strong> Add file <code>dna_storage/components/channel/ml_channel.py</code>. Accept: file present with imports.</li>
<li><strong>2.2</strong> Implement <code>MLChannel</code> class with typed methods: <code>__init__</code>, <code>fit</code>, <code>transmit</code>, <code>save</code>, <code>load</code>. Accept: class compiles and docstrings explain API.</li>
<li><strong>2.3</strong> Make <code>transmit</code> delegate to <code>IDSChannel</code> if <code>self.model is None</code> for safe default. Accept: behavior matches IDSChannel for model=None.</li>
<li><strong>2.4</strong> Add placeholder <code>fit</code> raising <code>NotImplementedError</code> and add tests expecting it (to be replaced later). Accept: tests pass.</li>
<li><strong>2.5</strong> Implement <code>save</code>/<code>load</code> to write <code>config.json</code> and <code>model.pt</code>. Accept: files created on save.</li>
<li><strong>2.6</strong> Add type hints and examples in module docstring showing how to call <code>fit</code> and <code>transmit</code>. Accept: docstrings clear and accurate.</li>
<li><strong>2.7</strong> Add tests <code>tests/test_ml_channel_api.py</code> for API and default behavior. Accept: tests pass in CI.</li>
<li><strong>2.8</strong> Create PR titled "feat(ml): add MLChannel skeleton + API" and request review. Accept: PR exists for early feedback.</li>
</ul>

<hr>
<h2>3. Training harness & RNN baseline (3.1–3.10)</h2>
<ul>
<li><strong>3.1</strong> Add <code>examples/ml_train.py</code> CLI skeleton supporting <code>--data</code> <code>--out</code> <code>--epochs</code>. Accept: <code>--help</code> prints usage.</li>
<li><strong>3.2</strong> Add package <code>dna_storage.ml</code> and <code>models.py</code> with <code>RNNChannelModel</code> and a small transformer. Accept: models importable and simple forward pass works.</li>
<li><strong>3.3</strong> Implement dataset loader <code>dna_storage.ml.data.SyntheticReadDataset</code> reading ndjson and tokenizing sequences. Accept: DataLoader yields batches.</li>
<li><strong>3.4</strong> Implement training loop: checkpointing, metrics logging (JSON), deterministic seed. Accept: one epoch runs on toy dataset producing checkpoint & metrics file.</li>
<li><strong>3.5</strong> Add evaluation utilities to compute per-base log-likelihood & calibration metrics. Accept: evaluation script outputs JSON metrics.</li>
<li><strong>3.6</strong> Add smoke unit test <code>tests/test_ml_train.py</code> running 1 epoch on toy data. Accept: test completes within CI limits (e.g., <2 min).</li>
<li><strong>3.7</strong> Document hyperparameters & small example config in <code>docs/experiments/configs/ml_small.yaml</code>. Accept: YAML exists and maps to CLI args.</li>
<li><strong>3.8</strong> Run local smoke training and validate checkpoint & metrics. Accept: outputs present and loadable.</li>
<li><strong>3.9</strong> Update <code>MLChannel.fit</code> to call <code>examples/ml_train.py</code> programmatically or import training helpers (replace NotImplementedError). Accept: fit works end-to-end for small dataset.</li>
<li><strong>3.10</strong> Add PR "feat(ml): add training harness + RNN baseline" for review. Accept: PR created and CI smoke tests pass.</li>
</ul>

<hr>
<h2>4. Bench integration & smoke pipeline (4.1–4.7)</h2>
<ul>
<li><strong>4.1</strong> Add <code>examples/bench_ml_channel.py</code> that accepts <code>--channel ids|ml:/path</code> and writes bench CSV. Accept: running with ids reproduces previous CSV format.</li>
<li><strong>4.2</strong> Refactor <code>examples/benchmark_rs.py</code> to accept channel factory/object; ensure backward compatibility. Accept: existing examples continue to work.</li>
<li><strong>4.3</strong> Add loader <code>ml_channel_factory</code> that loads saved MLChannel and integrates with bench. Accept: bench can call factory and execute transmission calls with MLChannel.
</li>
<li><strong>4.4</strong> Add smoke bench config (<code>docs/experiments/configs/bench_smoke.yaml</code>) with small trials. Accept: smoke bench runs in <2 minutes.</li>
<li><strong>4.5</strong> Run smoke bench comparing ids vs ml and save CSV outputs. Accept: files <code>bench_rs_smoke_ids.csv</code> and <code>bench_rs_smoke_ml.csv</code> exist.</li>
<li><strong>4.6</strong> Add quick-plot script <code>examples/plot_bench_comparison.py</code> to visualize differences. Accept: script generates PNG.
</li>
<li><strong>4.7</strong> Add integration test to run smoke bench and assert CSVs exist and culumns are correct. Accept: test passes in CI.
</li>
</ul>

<hr>
<h2>5. DoE and large runs (5.1–5.6)</h2>
<ul>
<li><strong>5.1</strong> Implement <code>tools/run_experiments.py</code> that reads YAML grid & runs benches (parallelizable). Accept: runs sample grid with reduced trials.</li>
<li><strong>5.2</strong> Add DoE YAML <code>docs/experiments/configs/bench_doe.yaml</code> with grid and trials=20 for pilot runs. Accept: file present.</li>
<li><strong>5.3</strong> Add aggregation utility to summarize mean/std to JSON/CSV. Accept: outputs created for pilot run.</li>
<li><strong>5.4</strong> Run pilot DoE (reduced grid), measure runtime & memory, record in <code>docs/experiments/compute.md</code>. Accept: metrics recorded.</li>
<li><strong>5.5</strong> Schedule full runs on available compute based on pilot estimates (trials=50–200). Accept: run completes and data archived.
</li>
<li><strong>5.6</strong> Create plotting utilities to produce main figures from aggregated data. Accept: figure PNGs created in <code>figures/</code>.</li>
</ul>

<hr>
<h2>6. Ablations & sensitivity (6.1–6.7)</h2>
<ul>
<li><strong>6.1</strong> Define ablation configs (no-context, partial-context). Accept: config files present.</li>
<li><strong>6.2</strong> Run ablation pilot runs (reduced trials) and aggregate. Accept: outputs available.</li>
<li><strong>6.3</strong> Produce ablation plots and summary doc. Accept: <code>docs/experiments/ablation_summary.md</code> updated.</li>
</ul>

<hr>
<h2>7. Analysis, figures & writing</h2>
<ul>
<li><strong>7.1</strong> Produce main figures (recovery vs error, likelihood, calibration). Accept: figures present and commented in captions.</li>
<li><strong>7.2</strong> Draft methods & results sections using experimental artifacts. Accept: draft present in <code>docs/paper_draft/</code>.</li>
<li><strong>7.3</strong> Package artifacts & prepare supplementary materials. Accept: zip archive with scripts & sample data present.</li>
</ul>

<hr>
<h2>8. Reproducibility & CI</h2>
<ul>
<li><strong>8.1</strong> Add unit tests for new modules and smoke CI workflow <code>ci/smoke-ml.yml</code>. Accept: CI runs successfully on PRs.</li>
<li><strong>8.2</strong> Add optional Dockerfile <code>docker/Dockerfile.ml</code> to reproduce heavy runs. Accept: Docker builds.</li>
<li><strong>8.3</strong> Tag release candidate once artifacts and docs are ready. Accept: tag created.</li>
</ul>

<hr>
<h2>9. Submission & Aftermath</h2>
<ul>
<li><strong>9.1</strong> Finalize manuscript and co-author review. Accept: draft ready and shared.</li>
<li><strong>9.2</strong> Submit and archive code & data. Accept: submission done and DOI created for data/code.</li>
</ul>

<hr>
<p><em>Immediate execution order: 0.1 → 1.1 → 1.2 → 1.3 → 2.1 → 2.2 → create PR for skeleton</em>.</p>
</body>
</html>